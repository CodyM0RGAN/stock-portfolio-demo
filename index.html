<!DOCTYPE html>
<html>
<head>
    <title>StockDB Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        .chart-container { width: 80%; margin: 20px auto; }
        select { padding: 8px; margin: 10px; }
    </style>
</head>
<body>
    <h1>Portfolio Performance</h1>
    <select id="portfolioFilter" onchange="loadData()">
        <option value="all">All Portfolios</option>
    </select>
    <div class="chart-container">
        <canvas id="chart"></canvas>
    </div>

    <script>
        let chart;
        
        async function init() {
            const response = await axios.get('/api/portfolio-metrics');
            const filter = document.getElementById('portfolioFilter');
            response.data.data.forEach(p => {
                const option = document.createElement('option');
                option.value = p.PortfolioName;
                option.text = p.PortfolioName;
                filter.appendChild(option);
            });
            loadData();
        }

        async function loadData() {
            const portfolio = document.getElementById('portfolioFilter').value;
            const url = portfolio === 'all' 
                ? '/api/portfolio-metrics' 
                : `/api/portfolio-metrics?portfolio=${encodeURIComponent(portfolio)}`;
            
            const { data } = await axios.get(url);
            
            if (chart) chart.destroy();
            
            const ctx = document.getElementById('chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.data.map(p => p.PortfolioName),
                    datasets: [{
                        label: 'Total Value ($)',
                        data: data.data.map(p => p.TotalValue),
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    }]
                }
            });
        }

        init();
    </script>
</body>
</html>